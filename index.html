<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SNM</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        .item {
            display: block;
            border: 1px solid black;
            padding: 10px;
            border-radius: 10px;
            margin-left: 10px;
        }
    </style>
</head>
<body onload="loadGenres();">
    <div class="container mt-3">
        <select class="form-select form-select-lg mb-3" aria-label="Large select example" onchange="addGenre(this.value);" id="sel-gen">
            <option value="" selected>Genres</option>
        </select>

        <ul class="list-group list-group-horizontal ">
            <li class="item d-flex d-none"  id="selected-genres">
                <label class="form-check-label me-2" id="lbl" for="firstRadio">item</label>
                <div role="button" id="close-btn" onclick="this.parentElement.remove();">
                    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-x" viewBox="0 0 16 16">
                        <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/>
                    </svg>
                </div>
            </li>
        </ul>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <script src="JavaScript/func.js"></script>
    <script>
        async function loadGenres() {
            const options =  {
            method: "GET",
            headers: {
                Authorization: localStorage.getItem('api_key')
            }
        }
            fetch('https://api.spotify.com/v1/recommendations/available-genre-seeds',options)
                .then((res) => {
                    if (!res.ok) {
                        if (res.status == 401) {
                            getApiToken()
                                .then((res) => {
                                    localStorage.setItem('api_key', res.token_type+' '+res.access_token);
                                })
                            loadGenres();
                        }
                    } else {
                        return res.json();
                    }
                })
                .then((json) => {
                    console.log(json);
                    let select = document.getElementById('sel-gen');
                    for (let i = 0; i < json.genres.length; i++) {
                        let option = document.createElement('option');
                        option.value = json.genres[i];
                        option.innerHTML = json.genres[i];
                        select.appendChild(option);
                    }
                });

            //console.log(res);
        }
        const list = document.getElementById('selected-genres');
        function addGenre(genre) {
            let clone = list.cloneNode(true);

            clone.getElementsByClassName('form-check-label')[0].innerHTML = genre;
            clone.classList.remove('d-none');
            list.before(clone);
        }
    </script>
</body>
</html>